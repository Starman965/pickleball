<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pickleball Tournament Manager - Pickleball Tracker</title>
    <meta name="description" content="A simple pickleball tournament manager for singles, doubles, and partner rotation. Create brackets, track scores, and manage tournaments in your browser.">
    <meta name="author" content="David Lewis">
    <meta name="robots" content="index, follow">
    <meta name="application-name" content="Pickleball Tracker">
    <meta name="apple-itunes-app" content="app-id=6744275703">
    <link rel="canonical" href="https://www.blackhawkpickle.com/pbm.html">
    <link rel="icon" type="image/png" href="pickleball_tracker_splash_icon.png">
    <link rel="apple-touch-icon" href="pickleball_tracker_splash_icon.png">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
<script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide icons as simple SVG components
    const Trophy = ({ className }) => (
        <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
        </svg>
    );

    const Users = ({ className }) => (
        <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
    );

    const Plus = ({ className }) => (
        <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
        </svg>
    );

    const Trash2 = ({ className }) => (
        <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
    );

    const Edit2 = ({ className }) => (
        <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
    );

    const Save = ({ className }) => (
        <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
        </svg>
    );

    const X = ({ className }) => (
        <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
        </svg>
    );

    // Simple localStorage-based storage implementation
    const storage = {
        async get(key) {
            try {
                const value = localStorage.getItem(key);
                return value ? { key, value, shared: false } : null;
            } catch (error) {
                console.error('Storage get error:', error);
                return null;
            }
        },
        async set(key, value) {
            try {
                localStorage.setItem(key, value);
                return { key, value, shared: false };
            } catch (error) {
                console.error('Storage set error:', error);
                return null;
            }
        },
        async delete(key) {
            try {
                localStorage.removeItem(key);
                return { key, deleted: true, shared: false };
            } catch (error) {
                console.error('Storage delete error:', error);
                return null;
            }
        },
        async list(prefix = '') {
            try {
                const keys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith(prefix)) {
                        keys.push(key);
                    }
                }
                return { keys, prefix, shared: false };
            } catch (error) {
                console.error('Storage list error:', error);
                return { keys: [], prefix, shared: false };
            }
        }
    };

    // Make storage available globally
    window.storage = storage;

    function PickleballTournament() {
        const [tournaments, setTournaments] = useState([]);
        const [currentTournament, setCurrentTournament] = useState(null);
        const [view, setView] = useState('list');
        const [newTournamentName, setNewTournamentName] = useState('');
        const [newTournamentFormat, setNewTournamentFormat] = useState('single-elimination');
        const [tournamentType, setTournamentType] = useState('doubles');
        const [players, setPlayers] = useState([]);
        const [newPlayerName, setNewPlayerName] = useState('');
        const [bracket, setBracket] = useState(null);
        const [editingMatch, setEditingMatch] = useState(null);
        const [teams, setTeams] = useState([]);
        const [showTeamBuilder, setShowTeamBuilder] = useState(false);
        const [rotationSchedule, setRotationSchedule] = useState(null);
        const [playerStats, setPlayerStats] = useState({});

        useEffect(() => {
            loadTournaments();
        }, []);

        const loadTournaments = async () => {
            try {
                const result = await storage.list('tournament:');
                if (result && result.keys) {
                    const tournamentData = await Promise.all(
                        result.keys.map(async (key) => {
                            const data = await storage.get(key);
                            return data ? JSON.parse(data.value) : null;
                        })
                    );
                    setTournaments(tournamentData.filter(t => t !== null));
                }
            } catch (error) {
                console.log('No tournaments found or error loading:', error);
                setTournaments([]);
            }
        };

        const saveTournament = async (tournament) => {
            try {
                await storage.set(
                    `tournament:${tournament.id}`,
                    JSON.stringify(tournament)
                );
            } catch (error) {
                console.error('Error saving tournament:', error);
            }
        };

        const createTournament = () => {
            if (!newTournamentName.trim()) return;

            const tournament = {
                id: Date.now().toString(),
                name: newTournamentName,
                format: newTournamentFormat,
                type: tournamentType,
                players: [],
                teams: [],
                bracket: null,
                rotationSchedule: null,
                playerStats: {},
                createdAt: new Date().toISOString(),
                status: 'setup'
            };

            setTournaments([...tournaments, tournament]);
            setCurrentTournament(tournament);
            setPlayers([]);
            setTeams([]);
            setRotationSchedule(null);
            setPlayerStats({});
            setNewTournamentName('');
            setView('manage');
            saveTournament(tournament);
        };

        const addPlayer = () => {
            if (!newPlayerName.trim()) return;

            const updatedPlayers = [...players, {
                id: Date.now().toString(),
                name: newPlayerName.trim(),
                rating: 3.5
            }];

            setPlayers(updatedPlayers);
            setNewPlayerName('');

            if (currentTournament) {
                const updated = { ...currentTournament, players: updatedPlayers };
                setCurrentTournament(updated);
                saveTournament(updated);
                setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
            }
        };

        const removePlayer = (playerId) => {
            const updatedPlayers = players.filter(p => p.id !== playerId);
            setPlayers(updatedPlayers);

            if (currentTournament) {
                const updated = { ...currentTournament, players: updatedPlayers };
                setCurrentTournament(updated);
                saveTournament(updated);
                setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
            }
        };

        const generateRandomTeams = () => {
            if (players.length < 4 || players.length % 2 !== 0) {
                alert('Need an even number of players (at least 4) to create doubles teams');
                return;
            }

            const shuffled = [...players].sort(() => Math.random() - 0.5);
            const newTeams = [];
            
            for (let i = 0; i < shuffled.length; i += 2) {
                newTeams.push({
                    id: `team-${Date.now()}-${i}`,
                    player1: shuffled[i],
                    player2: shuffled[i + 1],
                    name: `${shuffled[i].name} / ${shuffled[i + 1].name}`
                });
            }

            setTeams(newTeams);
            const updated = { ...currentTournament, teams: newTeams };
            setCurrentTournament(updated);
            saveTournament(updated);
            setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
            setShowTeamBuilder(false);
        };

        const generateBalancedTeams = () => {
            if (players.length < 4 || players.length % 2 !== 0) {
                alert('Need an even number of players (at least 4) to create doubles teams');
                return;
            }

            const sorted = [...players].sort((a, b) => (b.rating || 3.5) - (a.rating || 3.5));
            const newTeams = [];
            
            for (let i = 0; i < sorted.length / 2; i++) {
                const player1 = sorted[i];
                const player2 = sorted[sorted.length - 1 - i];
                
                newTeams.push({
                    id: `team-${Date.now()}-${i}`,
                    player1,
                    player2,
                    name: `${player1.name} / ${player2.name}`,
                    avgRating: ((player1.rating || 3.5) + (player2.rating || 3.5)) / 2
                });
            }

            setTeams(newTeams);
            const updated = { ...currentTournament, teams: newTeams };
            setCurrentTournament(updated);
            saveTournament(updated);
            setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
            setShowTeamBuilder(false);
        };

        const clearTeams = () => {
            setTeams([]);
            const updated = { ...currentTournament, teams: [] };
            setCurrentTournament(updated);
            saveTournament(updated);
            setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
        };

        const generatePartnerRotation = () => {
            if (players.length < 4 || players.length % 4 !== 0) {
                alert('Partner rotation works best with multiples of 4 players (4, 8, 12, 16...)');
                return;
            }

            const numPlayers = players.length;
            const courtsPerRound = numPlayers / 4;
            const numRounds = numPlayers - 1;
            
            const schedule = [];
            const shuffled = [...players].sort(() => Math.random() - 0.5);
            
            const stats = {};
            shuffled.forEach(p => {
                stats[p.id] = {
                    player: p,
                    wins: 0,
                    losses: 0,
                    totalPoints: 0,
                    gamesPlayed: 0
                };
            });

            for (let round = 0; round < Math.min(numRounds, 10); round++) {
                const roundMatches = [];
                const usedPlayers = new Set();
                
                for (let court = 0; court < courtsPerRound; court++) {
                    const availablePlayers = shuffled.filter(p => !usedPlayers.has(p.id));
                    
                    if (availablePlayers.length >= 4) {
                        const [p1, p2, p3, p4] = availablePlayers.slice(0, 4);
                        
                        roundMatches.push({
                            id: `pr-r${round}-c${court}`,
                            court: court + 1,
                            team1: { player1: p1, player2: p2 },
                            team2: { player1: p3, player2: p4 },
                            score1: null,
                            score2: null,
                            winner: null
                        });
                        
                        [p1, p2, p3, p4].forEach(p => usedPlayers.add(p.id));
                    }
                }
                
                if (roundMatches.length > 0) {
                    schedule.push({
                        round: round + 1,
                        matches: roundMatches
                    });
                }
                
                if (round < numRounds - 1) {
                    const first = shuffled.shift();
                    shuffled.push(first);
                }
            }

            setRotationSchedule(schedule);
            setPlayerStats(stats);
            const updated = { 
                ...currentTournament, 
                rotationSchedule: schedule,
                playerStats: stats,
                status: 'in-progress'
            };
            setCurrentTournament(updated);
            saveTournament(updated);
            setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
        };

        const updateRotationScore = (roundIdx, matchIdx, score1, score2) => {
            const newSchedule = JSON.parse(JSON.stringify(rotationSchedule));
            const match = newSchedule[roundIdx].matches[matchIdx];
            
            match.score1 = score1;
            match.score2 = score2;

            const newStats = { ...playerStats };
            
            if (score1 !== null && score2 !== null && score1 !== '' && score2 !== '') {
                const s1 = parseInt(score1);
                const s2 = parseInt(score2);
                
                const team1Players = [match.team1.player1.id, match.team1.player2.id];
                const team2Players = [match.team2.player1.id, match.team2.player2.id];
                
                if (s1 > s2) {
                    match.winner = 'team1';
                    team1Players.forEach(pid => {
                        newStats[pid].wins++;
                        newStats[pid].totalPoints += s1;
                        newStats[pid].gamesPlayed++;
                    });
                    team2Players.forEach(pid => {
                        newStats[pid].losses++;
                        newStats[pid].totalPoints += s2;
                        newStats[pid].gamesPlayed++;
                    });
                } else if (s2 > s1) {
                    match.winner = 'team2';
                    team2Players.forEach(pid => {
                        newStats[pid].wins++;
                        newStats[pid].totalPoints += s2;
                        newStats[pid].gamesPlayed++;
                    });
                    team1Players.forEach(pid => {
                        newStats[pid].losses++;
                        newStats[pid].totalPoints += s1;
                        newStats[pid].gamesPlayed++;
                    });
                }
            } else {
                match.winner = null;
            }

            setRotationSchedule(newSchedule);
            setPlayerStats(newStats);
            const updated = { 
                ...currentTournament, 
                rotationSchedule: newSchedule,
                playerStats: newStats
            };
            setCurrentTournament(updated);
            saveTournament(updated);
            setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
            setEditingMatch(null);
        };

        const updatePlayerRating = (playerId, newRating) => {
            const updatedPlayers = players.map(p => 
                p.id === playerId ? { ...p, rating: parseFloat(newRating) || 3.5 } : p
            );
            setPlayers(updatedPlayers);
            
            if (currentTournament) {
                const updated = { ...currentTournament, players: updatedPlayers };
                setCurrentTournament(updated);
                saveTournament(updated);
                setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
            }
        };

        const generateBracket = () => {
            const participants = currentTournament.type === 'doubles' ? teams : players;
            
            if (participants.length < 2) {
                alert(`Need at least 2 ${currentTournament.type === 'doubles' ? 'teams' : 'players'} to generate a bracket`);
                return;
            }

            const shuffledParticipants = [...participants].sort(() => Math.random() - 0.5);
            
            if (currentTournament.format === 'single-elimination') {
                const bracketSize = Math.pow(2, Math.ceil(Math.log2(shuffledParticipants.length)));
                const rounds = Math.ceil(Math.log2(bracketSize));
                
                const newBracket = {
                    rounds: [],
                    currentRound: 0
                };

                const firstRoundMatches = [];
                for (let i = 0; i < bracketSize / 2; i++) {
                    const participant1 = shuffledParticipants[i * 2] || null;
                    const participant2 = shuffledParticipants[i * 2 + 1] || null;
                    
                    firstRoundMatches.push({
                        id: `r0-m${i}`,
                        player1: participant1,
                        player2: participant2,
                        score1: null,
                        score2: null,
                        winner: participant1 && !participant2 ? participant1 : (participant2 && !participant1 ? participant2 : null)
                    });
                }
                newBracket.rounds.push(firstRoundMatches);

                for (let r = 1; r < rounds; r++) {
                    const roundMatches = [];
                    const prevRoundSize = newBracket.rounds[r - 1].length;
                    
                    for (let i = 0; i < prevRoundSize / 2; i++) {
                        roundMatches.push({
                            id: `r${r}-m${i}`,
                            player1: null,
                            player2: null,
                            score1: null,
                            score2: null,
                            winner: null
                        });
                    }
                    newBracket.rounds.push(roundMatches);
                }

                setBracket(newBracket);
                const updated = { ...currentTournament, bracket: newBracket, status: 'in-progress' };
                setCurrentTournament(updated);
                saveTournament(updated);
                setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
            } else if (currentTournament.format === 'round-robin') {
                const matches = [];
                for (let i = 0; i < shuffledParticipants.length; i++) {
                    for (let j = i + 1; j < shuffledParticipants.length; j++) {
                        matches.push({
                            id: `rr-${i}-${j}`,
                            player1: shuffledParticipants[i],
                            player2: shuffledParticipants[j],
                            score1: null,
                            score2: null,
                            winner: null
                        });
                    }
                }

                const newBracket = {
                    rounds: [matches],
                    currentRound: 0,
                    type: 'round-robin'
                };

                setBracket(newBracket);
                const updated = { ...currentTournament, bracket: newBracket, status: 'in-progress' };
                setCurrentTournament(updated);
                saveTournament(updated);
                setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
            }
        };

        const updateMatchScore = (roundIdx, matchIdx, score1, score2) => {
            const newBracket = JSON.parse(JSON.stringify(bracket));
            const match = newBracket.rounds[roundIdx][matchIdx];
            
            match.score1 = score1;
            match.score2 = score2;

            if (score1 !== null && score2 !== null && score1 !== '' && score2 !== '') {
                match.winner = parseInt(score1) > parseInt(score2) ? match.player1 : match.player2;

                if (currentTournament.format === 'single-elimination' && roundIdx < newBracket.rounds.length - 1) {
                    const nextRoundMatchIdx = Math.floor(matchIdx / 2);
                    const nextMatch = newBracket.rounds[roundIdx + 1][nextRoundMatchIdx];
                    
                    if (matchIdx % 2 === 0) {
                        nextMatch.player1 = match.winner;
                    } else {
                        nextMatch.player2 = match.winner;
                    }
                }
            } else {
                match.winner = null;
            }

            setBracket(newBracket);
            const updated = { ...currentTournament, bracket: newBracket };
            setCurrentTournament(updated);
            saveTournament(updated);
            setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
            setEditingMatch(null);
        };

        const deleteTournament = async (tournamentId) => {
            if (!confirm('Are you sure you want to delete this tournament?')) return;
            
            try {
                await storage.delete(`tournament:${tournamentId}`);
                setTournaments(tournaments.filter(t => t.id !== tournamentId));
                if (currentTournament?.id === tournamentId) {
                    setCurrentTournament(null);
                    setView('list');
                }
            } catch (error) {
                console.error('Error deleting tournament:', error);
            }
        };

        const selectTournament = (tournament) => {
            setCurrentTournament(tournament);
            setPlayers(tournament.players || []);
            setTeams(tournament.teams || []);
            setBracket(tournament.bracket || null);
            setRotationSchedule(tournament.rotationSchedule || null);
            setPlayerStats(tournament.playerStats || {});
            setView('manage');
        };

        const getRoundRobinStandings = () => {
            if (!bracket || bracket.type !== 'round-robin') return [];
            
            const participants = currentTournament.type === 'doubles' ? teams : players;
            const standings = {};
            participants.forEach(participant => {
                standings[participant.id] = { participant, wins: 0, losses: 0, points: 0 };
            });

            bracket.rounds[0].forEach(match => {
                if (match.winner) {
                    const loserId = match.winner.id === match.player1.id ? match.player2.id : match.player1.id;
                    standings[match.winner.id].wins++;
                    standings[loserId].losses++;
                    standings[match.winner.id].points += parseInt(match.score1 > match.score2 ? match.score1 : match.score2);
                    standings[loserId].points += parseInt(match.score1 > match.score2 ? match.score2 : match.score1);
                }
            });

            return Object.values(standings).sort((a, b) => b.wins - a.wins || b.points - a.points);
        };

        return (
            <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 p-6">
                <div className="max-w-6xl mx-auto">
                    <div className="mb-4 flex flex-wrap items-center justify-between gap-2">
                        <a href="index.html" className="text-sm font-semibold text-blue-700 hover:text-blue-900">
                            ← Back to Pickleball Tracker
                        </a>
                        <div className="flex flex-wrap gap-2 text-sm">
                            <a href="index.html" className="px-3 py-1 rounded-full bg-white/70 hover:bg-white shadow-sm">Home</a>
                            <span className="px-3 py-1 rounded-full bg-blue-600 text-white shadow-sm">Tournament Manager</span>
                            <a href="pbm-instructions.html" className="px-3 py-1 rounded-full bg-white/70 hover:bg-white shadow-sm">Instructions</a>
                        </div>
                    </div>
                    <div className="bg-white rounded-lg shadow-lg p-8">
                        <div className="flex items-center justify-between mb-8">
                            <div className="flex items-center gap-3">
                                <Trophy className="w-8 h-8 text-green-600" />
                                <h1 className="text-3xl font-bold text-gray-800">Pickleball Tournament Manager</h1>
                            </div>
                            {view !== 'list' && (
                                <button
                                    onClick={() => {
                                        setView('list');
                                        setCurrentTournament(null);
                                    }}
                                    className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
                                >
                                    Back to Tournaments
                                </button>
                            )}
                        </div>

                        {view === 'list' && (
                            <div>
                                <div className="mb-6">
                                    <h2 className="text-xl font-semibold mb-4">Create New Tournament</h2>
                                    <div className="space-y-3">
                                        <input
                                            type="text"
                                            placeholder="Tournament name"
                                            value={newTournamentName}
                                            onChange={(e) => setNewTournamentName(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && createTournament()}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                        />
                                        <div className="grid grid-cols-2 gap-3">
                                            <select
                                                value={tournamentType}
                                                onChange={(e) => setTournamentType(e.target.value)}
                                                className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                            >
                                                <option value="singles">Singles</option>
                                                <option value="doubles">Doubles</option>
                                                <option value="partner-rotation">Partner Rotation</option>
                                            </select>
                                            <select
                                                value={newTournamentFormat}
                                                onChange={(e) => setNewTournamentFormat(e.target.value)}
                                                className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                                disabled={tournamentType === 'partner-rotation'}
                                            >
                                                <option value="single-elimination">Single Elimination</option>
                                                <option value="round-robin">Round Robin</option>
                                            </select>
                                        </div>
                                        <button
                                            onClick={createTournament}
                                            className="w-full px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2"
                                        >
                                            <Plus className="w-5 h-5" />
                                            Create Tournament
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <h2 className="text-xl font-semibold mb-4">Your Tournaments</h2>
                                    {tournaments.length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">No tournaments yet. Create one to get started!</p>
                                    ) : (
                                        <div className="grid gap-4">
                                            {tournaments.map(tournament => (
                                                <div
                                                    key={tournament.id}
                                                    className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition cursor-pointer"
                                                    onClick={() => selectTournament(tournament)}
                                                >
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <h3 className="text-lg font-semibold text-gray-800">{tournament.name}</h3>
                                                            <p className="text-sm text-gray-600">
                                                                {tournament.type === 'partner-rotation' ? 'Partner Rotation' : 
                                                                 tournament.type === 'doubles' ? 'Doubles' : 'Singles'}
                                                                {tournament.type !== 'partner-rotation' && (
                                                                    <>{' • '}{tournament.format === 'single-elimination' ? 'Single Elimination' : 'Round Robin'}</>
                                                                )}
                                                                {' • '}
                                                                {tournament.players?.length || 0} players
                                                                {tournament.type === 'doubles' && tournament.teams?.length > 0 && (
                                                                    <> ({tournament.teams.length} teams)</>
                                                                )}
                                                                {' • '}
                                                                <span className="capitalize">{tournament.status}</span>
                                                            </p>
                                                        </div>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                deleteTournament(tournament.id);
                                                            }}
                                                            className="text-red-500 hover:text-red-700"
                                                        >
                                                            <Trash2 className="w-5 h-5" />
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {view === 'manage' && currentTournament && (
                            <div>
                                <h2 className="text-2xl font-bold mb-2">{currentTournament.name}</h2>
                                <p className="text-gray-600 mb-6">
                                    {currentTournament.type === 'partner-rotation' ? 'Partner Rotation' : 
                                     currentTournament.type === 'doubles' ? 'Doubles Tournament' : 'Singles Tournament'}
                                    {currentTournament.type !== 'partner-rotation' && (
                                        <> - {currentTournament.format === 'single-elimination' ? 'Single Elimination' : 'Round Robin'}</>
                                    )}
                                </p>

                                {!bracket && !rotationSchedule && (
                                    <div className="mb-8">
                                        <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
                                            <Users className="w-5 h-5" />
                                            Players ({players.length})
                                        </h3>
                                        
                                        <div className="flex gap-3 mb-4">
                                            <input
                                                type="text"
                                                placeholder="Player name"
                                                value={newPlayerName}
                                                onChange={(e) => setNewPlayerName(e.target.value)}
                                                onKeyPress={(e) => e.key === 'Enter' && addPlayer()}
                                                className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                            />
                                            <button
                                                onClick={addPlayer}
                                                className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2"
                                            >
                                                <Plus className="w-5 h-5" />
                                                Add Player
                                            </button>
                                        </div>

                                        <div className="grid gap-2 mb-4">
                                            {players.map(player => (
                                                <div key={player.id} className="flex items-center justify-between bg-gray-50 px-4 py-3 rounded-lg">
                                                    <span className="font-medium flex-1">{player.name}</span>
                                                    <div className="flex items-center gap-3">
                                                        <label className="text-sm text-gray-600">Rating:</label>
                                                        <input
                                                            type="number"
                                                            min="1.0"
                                                            max="5.5"
                                                            step="0.5"
                                                            value={player.rating || 3.5}
                                                            onChange={(e) => updatePlayerRating(player.id, e.target.value)}
                                                            className="w-16 px-2 py-1 border border-gray-300 rounded text-center"
                                                        />
                                                        <button
                                                            onClick={() => removePlayer(player.id)}
                                                            className="text-red-500 hover:text-red-700"
                                                        >
                                                            <Trash2 className="w-4 h-4" />
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        {currentTournament.type === 'doubles' && (
                                            <div className="mb-4">
                                                {teams.length === 0 ? (
                                                    <div className="space-y-2">
                                                        <button
                                                            onClick={() => setShowTeamBuilder(!showTeamBuilder)}
                                                            className="w-full px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-semibold"
                                                        >
                                                            {showTeamBuilder ? 'Hide Team Builder' : 'Create Doubles Teams'}
                                                        </button>
                                                        
                                                        {showTeamBuilder && (
                                                            <div className="bg-purple-50 p-4 rounded-lg space-y-2">
                                                                <p className="text-sm text-gray-700 mb-3">Generate teams automatically:</p>
                                                                <button
                                                                    onClick={generateRandomTeams}
                                                                    className="w-full px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition"
                                                                    disabled={players.length < 4 || players.length % 2 !== 0}
                                                                >
                                                                    Random Teams
                                                                </button>
                                                                <button
                                                                    onClick={generateBalancedTeams}
                                                                    className="w-full px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition"
                                                                    disabled={players.length < 4 || players.length % 2 !== 0}
                                                                >
                                                                    Balanced Teams (by rating)
                                                                </button>
                                                                {(players.length < 4 || players.length % 2 !== 0) && (
                                                                    <p className="text-xs text-red-600 text-center mt-2">
                                                                        Need an even number of players (at least 4)
                                                                    </p>
                                                                )}
                                                            </div>
                                                        )}
                                                    </div>
                                                ) : (
                                                    <div>
                                                        <div className="flex justify-between items-center mb-3">
                                                            <h4 className="font-semibold">Teams ({teams.length})</h4>
                                                            <button
                                                                onClick={clearTeams}
                                                                className="text-sm text-red-600 hover:text-red-700"
                                                            >
                                                                Clear Teams
                                                            </button>
                                                        </div>
                                                        <div className="grid gap-2 mb-4">
                                                            {teams.map(team => (
                                                                <div key={team.id} className="bg-purple-50 px-4 py-3 rounded-lg">
                                                                    <div className="font-medium">{team.name}</div>
                                                                    {team.avgRating && (
                                                                        <div className="text-xs text-gray-600">
                                                                            Avg Rating: {team.avgRating.toFixed(1)}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        )}

                                        {currentTournament.type === 'partner-rotation' ? (
                                            <button
                                                onClick={generatePartnerRotation}
                                                disabled={players.length < 4}
                                                className="w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:bg-gray-300 disabled:cursor-not-allowed font-semibold"
                                            >
                                                Generate Partner Rotation Schedule
                                            </button>
                                        ) : (
                                            <button
                                                onClick={generateBracket}
                                                disabled={
                                                    currentTournament.type === 'doubles' 
                                                        ? teams.length < 2 
                                                        : players.length < 2
                                                }
                                                className="w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:bg-gray-300 disabled:cursor-not-allowed font-semibold"
                                            >
                                                Generate Bracket
                                            </button>
                                        )}
                                    </div>
                                )}

                                {rotationSchedule && (
                                    <div>
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="text-lg font-semibold">Partner Rotation Schedule</h3>
                                            <button
                                                onClick={() => {
                                                    if (confirm('Reset schedule and modify players?')) {
                                                        setRotationSchedule(null);
                                                        setPlayerStats({});
                                                        const updated = { ...currentTournament, rotationSchedule: null, playerStats: {}, status: 'setup' };
                                                        setCurrentTournament(updated);
                                                        saveTournament(updated);
                                                        setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
                                                    }
                                                }}
                                                className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition text-sm"
                                            >
                                                Reset Schedule
                                            </button>
                                        </div>

                                        <div className="mb-8 bg-blue-50 p-4 rounded-lg">
                                            <h4 className="font-semibold mb-3">Player Standings</h4>
                                            <div className="grid gap-2">
                                                {Object.values(playerStats)
                                                    .sort((a, b) => b.wins - a.wins || b.totalPoints - a.totalPoints)
                                                    .map((stat, idx) => (
                                                        <div key={stat.player.id} className="flex items-center justify-between bg-white px-4 py-2 rounded">
                                                            <span className="font-medium">
                                                                {idx + 1}. {stat.player.name}
                                                            </span>
                                                            <span className="text-sm text-gray-600">
                                                                {stat.wins}W - {stat.losses}L | {stat.totalPoints} pts | {stat.gamesPlayed} games
                                                            </span>
                                                        </div>
                                                    ))}
                                            </div>
                                        </div>

                                        {rotationSchedule.map((roundData, roundIdx) => (
                                            <div key={roundIdx} className="mb-8">
                                                <h4 className="font-semibold mb-4 text-lg">Round {roundData.round}</h4>
                                                <div className="grid gap-4 md:grid-cols-2">
                                                    {roundData.matches.map((match, matchIdx) => (
                                                        <div key={match.id} className="border-2 border-gray-300 rounded-lg p-4 bg-white">
                                                            <div className="text-sm font-semibold text-gray-600 mb-3">Court {match.court}</div>
                                                            
                                                            <div className={`p-3 rounded mb-2 ${match.winner === 'team1' ? 'bg-green-100 font-semibold' : 'bg-gray-50'}`}>
                                                                <div className="flex items-center justify-between">
                                                                    <div>
                                                                        <div className="font-medium">{match.team1.player1.name}</div>
                                                                        <div className="font-medium">{match.team1.player2.name}</div>
                                                                    </div>
                                                                    {editingMatch === `pr-${roundIdx}-${matchIdx}` ? (
                                                                        <input
                                                                            type="number"
                                                                            min="0"
                                                                            defaultValue={match.score1 || ''}
                                                                            className="w-16 px-2 py-1 border border-gray-300 rounded text-center"
                                                                            id={`pr-score1-${roundIdx}-${matchIdx}`}
                                                                        />
                                                                    ) : (
                                                                        <span className="text-2xl font-bold">{match.score1 ?? '-'}</span>
                                                                    )}
                                                                </div>
                                                            </div>

                                                            <div className={`p-3 rounded mb-3 ${match.winner === 'team2' ? 'bg-green-100 font-semibold' : 'bg-gray-50'}`}>
                                                                <div className="flex items-center justify-between">
                                                                    <div>
                                                                        <div className="font-medium">{match.team2.player1.name}</div>
                                                                        <div className="font-medium">{match.team2.player2.name}</div>
                                                                    </div>
                                                                    {editingMatch === `pr-${roundIdx}-${matchIdx}` ? (
                                                                        <input
                                                                            type="number"
                                                                            min="0"
                                                                            defaultValue={match.score2 || ''}
                                                                            className="w-16 px-2 py-1 border border-gray-300 rounded text-center"
                                                                            id={`pr-score2-${roundIdx}-${matchIdx}`}
                                                                        />
                                                                    ) : (
                                                                        <span className="text-2xl font-bold">{match.score2 ?? '-'}</span>
                                                                    )}
                                                                </div>
                                                            </div>

                                                            <div className="flex gap-2">
                                                                {editingMatch === `pr-${roundIdx}-${matchIdx}` ? (
                                                                    <>
                                                                        <button
                                                                            onClick={() => {
                                                                                const score1 = document.getElementById(`pr-score1-${roundIdx}-${matchIdx}`).value;
                                                                                const score2 = document.getElementById(`pr-score2-${roundIdx}-${matchIdx}`).value;
                                                                                updateRotationScore(roundIdx, matchIdx, score1, score2);
                                                                            }}
                                                                            className="flex-1 px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition text-sm flex items-center justify-center gap-1"
                                                                        >
                                                                            <Save className="w-4 h-4" />
                                                                            Save
                                                                        </button>
                                                                        <button
                                                                            onClick={() => setEditingMatch(null)}
                                                                            className="flex-1 px-3 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition text-sm flex items-center justify-center gap-1"
                                                                        >
                                                                            <X className="w-4 h-4" />
                                                                            Cancel
                                                                        </button>
                                                                    </>
                                                                ) : (
                                                                    <button
                                                                        onClick={() => setEditingMatch(`pr-${roundIdx}-${matchIdx}`)}
                                                                        className="w-full px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition text-sm flex items-center justify-center gap-1"
                                                                    >
                                                                        <Edit2 className="w-4 h-4" />
                                                                        {match.score1 !== null ? 'Edit Score' : 'Enter Score'}
                                                                    </button>
                                                                )}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}

                                        {rotationSchedule.every(round => 
                                            round.matches.every(match => match.winner)
                                        ) && Object.values(playerStats).length > 0 && (
                                            <div className="mt-8 p-6 bg-gradient-to-r from-yellow-100 to-yellow-200 rounded-lg text-center">
                                                <Trophy className="w-12 h-12 text-yellow-600 mx-auto mb-2" />
                                                <h3 className="text-2xl font-bold text-gray-800">Tournament Winner</h3>
                                                <p className="text-xl mt-2">
                                                    {Object.values(playerStats)
                                                        .sort((a, b) => b.wins - a.wins || b.totalPoints - a.totalPoints)[0]
                                                        .player.name}
                                                </p>
                                                <p className="text-sm text-gray-600 mt-1">
                                                    {Object.values(playerStats)
                                                        .sort((a, b) => b.wins - a.wins || b.totalPoints - a.totalPoints)[0]
                                                        .wins} wins, {Object.values(playerStats)
                                                        .sort((a, b) => b.wins - a.wins || b.totalPoints - a.totalPoints)[0]
                                                        .totalPoints} points
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {bracket && (
                                    <div>
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="text-lg font-semibold">
                                                {currentTournament.format === 'single-elimination' ? 'Tournament Bracket' : 'Round Robin Matches'}
                                            </h3>
                                            <button
                                                onClick={() => {
                                                    if (confirm('Reset bracket and add more players?')) {
                                                        setBracket(null);
                                                        const updated = { ...currentTournament, bracket: null, status: 'setup' };
                                                        setCurrentTournament(updated);
                                                        saveTournament(updated);
                                                        setTournaments(tournaments.map(t => t.id === updated.id ? updated : t));
                                                    }
                                                }}
                                                className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition text-sm"
                                            >
                                                Reset Bracket
                                            </button>
                                        </div>

                                        {currentTournament.format === 'round-robin' && (
                                            <div className="mb-8 bg-blue-50 p-4 rounded-lg">
                                                <h4 className="font-semibold mb-3">Standings</h4>
                                                <div className="grid gap-2">
                                                    {getRoundRobinStandings().map((standing, idx) => (
                                                        <div key={standing.participant.id} className="flex items-center justify-between bg-white px-4 py-2 rounded">
                                                            <span className="font-medium">
                                                                {idx + 1}. {standing.participant.name}
                                                            </span>
                                                            <span className="text-sm text-gray-600">
                                                                {standing.wins}W - {standing.losses}L ({standing.points} pts)
                                                            </span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        <div className="overflow-x-auto">
                                            {bracket.rounds.map((round, roundIdx) => (
                                                <div key={roundIdx} className="mb-8">
                                                    <h4 className="font-semibold mb-4">
                                                        {currentTournament.format === 'single-elimination' 
                                                            ? roundIdx === bracket.rounds.length - 1 
                                                                ? 'Final' 
                                                                : roundIdx === bracket.rounds.length - 2
                                                                ? 'Semifinals'
                                                                : `Round ${roundIdx + 1}`
                                                            : 'All Matches'
                                                        }
                                                    </h4>
                                                    <div className="grid gap-4 md:grid-cols-2">
                                                        {round.map((match, matchIdx) => (
                                                            <div key={match.id} className="border border-gray-300 rounded-lg p-4 bg-white">
                                                                <div className="space-y-3">
                                                                    <div className={`flex items-center justify-between ${match.winner?.id === match.player1?.id ? 'bg-green-50 font-semibold' : ''} p-2 rounded`}>
                                                                        <span>{match.player1?.name || 'TBD'}</span>
                                                                        {editingMatch === `${roundIdx}-${matchIdx}` ? (
                                                                            <input
                                                                                type="number"
                                                                                min="0"
                                                                                defaultValue={match.score1 || ''}
                                                                                className="w-16 px-2 py-1 border border-gray-300 rounded text-center"
                                                                                id={`score1-${roundIdx}-${matchIdx}`}
                                                                            />
                                                                        ) : (
                                                                            <span className="font-bold">{match.score1 ?? '-'}</span>
                                                                        )}
                                                                    </div>
                                                                    <div className={`flex items-center justify-between ${match.winner?.id === match.player2?.id ? 'bg-green-50 font-semibold' : ''} p-2 rounded`}>
                                                                        <span>{match.player2?.name || 'TBD'}</span>
                                                                        {editingMatch === `${roundIdx}-${matchIdx}` ? (
                                                                            <input
                                                                                type="number"
                                                                                min="0"
                                                                                defaultValue={match.score2 || ''}
                                                                                className="w-16 px-2 py-1 border border-gray-300 rounded text-center"
                                                                                id={`score2-${roundIdx}-${matchIdx}`}
                                                                            />
                                                                        ) : (
                                                                            <span className="font-bold">{match.score2 ?? '-'}</span>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                                
                                                                {match.player1 && match.player2 && (
                                                                    <div className="mt-3 flex gap-2">
                                                                        {editingMatch === `${roundIdx}-${matchIdx}` ? (
                                                                            <>
                                                                                <button
                                                                                    onClick={() => {
                                                                                        const score1 = document.getElementById(`score1-${roundIdx}-${matchIdx}`).value;
                                                                                        const score2 = document.getElementById(`score2-${roundIdx}-${matchIdx}`).value;
                                                                                        updateMatchScore(roundIdx, matchIdx, score1, score2);
                                                                                    }}
                                                                                    className="flex-1 px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition text-sm flex items-center justify-center gap-1"
                                                                                >
                                                                                    <Save className="w-4 h-4" />
                                                                                    Save
                                                                                </button>
                                                                                <button
                                                                                    onClick={() => setEditingMatch(null)}
                                                                                    className="flex-1 px-3 py-1 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition text-sm flex items-center justify-center gap-1"
                                                                                >
                                                                                    <X className="w-4 h-4" />
                                                                                    Cancel
                                                                                </button>
                                                                            </>
                                                                        ) : (
                                                                            <button
                                                                                onClick={() => setEditingMatch(`${roundIdx}-${matchIdx}`)}
                                                                                className="w-full px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition text-sm flex items-center justify-center gap-1"
                                                                            >
                                                                                <Edit2 className="w-4 h-4" />
                                                                                {match.score1 !== null ? 'Edit Score' : 'Enter Score'}
                                                                            </button>
                                                                        )}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        {currentTournament.format === 'single-elimination' && 
                                         bracket.rounds[bracket.rounds.length - 1][0].winner && (
                                            <div className="mt-8 p-6 bg-gradient-to-r from-yellow-100 to-yellow-200 rounded-lg text-center">
                                                <Trophy className="w-12 h-12 text-yellow-600 mx-auto mb-2" />
                                                <h3 className="text-2xl font-bold text-gray-800">Tournament Champion</h3>
                                                <p className="text-xl mt-2">{bracket.rounds[bracket.rounds.length - 1][0].winner.name}</p>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            </div>
        );
    }

    ReactDOM.render(<PickleballTournament />, document.getElementById('root'));
</script>
</body>
</html>
